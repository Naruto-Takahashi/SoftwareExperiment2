# 2-Port Serial Multiplayer Tetris

独自マルチタスクカーネル上で動作する，C言語製の2ポート対戦型テトリスです．
2つのシリアルポート（UART）を使用し，2人のプレイヤーが同時にプレイ・対戦することができます．

## 📋 特徴・仕様

### システム仕様
* **協調的マルチタスク動作**: `mtk_c` カーネルを使用し，`skipmt()` によるCPU譲渡を行いながら2つのゲームタスク（Task1, Task2）を並列実行します．
* **2ポート独立入出力**:
    * Player 1: Port 0 (標準入出力)
    * Player 2: Port 1 (記述子 4)
* **高速描画（差分描画）**:
    * VT100エスケープシーケンスによるカラー表示．
    * 前回のフレームと変化があった箇所のみを転送・描画することで，シリアル通信の帯域を節約し，チラつきを抑えています．

### ゲームロジック仕様
* **7種1巡（7-Bag）システム**: 7種類のテミノ（ブロック）が1セットとしてランダムに出現するため，特定のミノが来ない偏りを防ぎます．
* **お邪魔ブロック攻撃**: ラインを複数同時に消すことで，相手フィールドにお邪魔ブロックを送り込むことができます．
* **フィールドサイズ**: 幅12（壁含む）× 高さ22（床含む）．

## 🎮 操作方法

ターミナルソフト（Tera Term, PuTTYなど）を接続し，キーボードで操作します．

| キー | 動作 | 説明 |
| :---: | :--- | :--- |
| **A** | 左移動 | ミノを左に1マス移動します |
| **D** | 右移動 | ミノを右に1マス移動します |
| **S** | 下移動 | ミノを下に1マス移動（ソフトドロップ） |
| **Space** | 回転 | ミノを右回りに90度回転させます |
| **Q** | 終了 | ゲームを強制終了します |

## ⚔️ 対戦ルール・攻撃システム

ラインを消去するとスコアが加算され，**2ライン以上**同時に消すと相手にお邪魔ブロック（Garbage）を送ることができます．

### 攻撃レート
| 消去ライン数 | 技名 | 相手への攻撃（段数） | スコア |
| :---: | :--- | :---: | :---: |
| 1 | Single | 0 | 100 |
| 2 | Double | **1** | 300 |
| 3 | Triple | **2** | 500 |
| 4 | Tetris | **4** | 800 |

* **お邪魔ブロックの処理**:
    * 送られたお邪魔ブロックは一度ストックされ，自分のミノが固定されたタイミングで下からせり上がります．
    * 一度にせり上がる上限は4段です．
    * せり上がるラインにはランダムな位置に1つの穴が空いています．

### ゲームオーバー条件
以下のいずれかの場合，そのプレイヤーは敗北（GAME OVER）となります．
1.  **窒息**: 新しいミノが出現した時点で，既にブロックと重なっていて動けない場合．
2.  **ロックアウト**: お邪魔ブロックのせり上がりにより，ブロックが天井（フィールド上部）を突き抜けた場合．

## 🛠️ ビルド・依存関係

本プログラムは，特定のマルチタスクカーネル環境（`mtk_c`）に依存しています．

### 必要ファイル
* `tetris_main.c`: ゲームロジックおよびメインエントリ
* `mtk_c.h`: マルチタスクカーネルヘッダ
* その他カーネルライブラリ（`init_kernel`, `set_task`, `inbyte`, `skipmt` 等の実装）

### コンパイル例
（環境に合わせてMakefile等を調整してください）
```bash
cc -o tetris tetris_main.c -L. -lmtk
